<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mind Map ToDo - Eisenhower Matrix</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 300;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .matrix {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .category-card {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            padding: 20px;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .category-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.15);
        }

        .category-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f0f0f0;
        }

        .category-icon {
            width: 30px;
            height: 30px;
            margin-right: 10px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            font-size: 0.9rem;
        }

        .urgent-important .category-icon {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
        }

        .urgent-not-important .category-icon {
            background: linear-gradient(45deg, #ffa726, #ff9800);
        }

        .not-urgent-important .category-icon {
            background: linear-gradient(45deg, #42a5f5, #2196f3);
        }

        .not-urgent-not-important .category-icon {
            background: linear-gradient(45deg, #66bb6a, #4caf50);
        }

        .category-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #333;
            flex: 1;
        }

        .task-count {
            background: #f5f5f5;
            color: #666;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .task-list {
            list-style: none;
        }

        .task-item {
            padding: 12px 0;
            border-bottom: 1px solid #f0f0f0;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
        }

        .task-item:last-child {
            border-bottom: none;
        }

        .task-item:hover {
            background: #f9f9f9;
            border-radius: 8px;
            padding-left: 10px;
            padding-right: 10px;
        }

        .task-checkbox {
            width: 18px;
            height: 18px;
            border: 2px solid #ddd;
            border-radius: 50%;
            margin-right: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            flex-shrink: 0;
        }

        .task-text {
            flex: 1;
            font-size: 0.95rem;
            line-height: 1.4;
            transition: all 0.3s ease;
        }

        .task-item.completed .task-checkbox {
            background: linear-gradient(45deg, #4caf50, #66bb6a);
            border-color: #4caf50;
        }

        .task-item.completed .task-checkbox::after {
            content: '✓';
            color: white;
            font-size: 12px;
            font-weight: bold;
        }

        .task-item.completed .task-text {
            text-decoration: line-through;
            color: #999;
            opacity: 0.6;
        }

        .stats {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            color: white;
            margin-top: 20px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 20px;
            margin-top: 15px;
        }

        .stat-item {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .stat-number {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.9rem;
            opacity: 0.8;
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            body {
                padding: 15px;
            }

            .header h1 {
                font-size: 2rem;
            }

            .matrix {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .category-card {
                padding: 15px;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 15px;
            }
        }

        @media (max-width: 480px) {
            .header h1 {
                font-size: 1.5rem;
            }

            .category-title {
                font-size: 1rem;
            }

            .task-text {
                font-size: 0.9rem;
            }
        }

        /* Animation for new completions */
        @keyframes taskComplete {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .task-item.just-completed {
            animation: taskComplete 0.5s ease;
        }

        /* Add Task Button */
        .add-task-btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 25px;
            padding: 10px 20px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 10px;
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .add-task-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 15px;
            padding: 30px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }

        .modal.show .modal-content {
            transform: scale(1);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }

        .modal-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: #333;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #999;
            padding: 5px;
            border-radius: 50%;
            width: 35px;
            height: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .close-btn:hover {
            background: #f0f0f0;
            color: #333;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        .form-input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
            font-family: inherit;
        }

        .form-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            background: white;
            cursor: pointer;
            transition: border-color 0.3s ease;
        }

        .form-select:focus {
            outline: none;
            border-color: #667eea;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 15px;
        }

        .reminder-checkbox {
            width: 18px;
            height: 18px;
            accent-color: #667eea;
        }

        .modal-actions {
            display: flex;
            gap: 15px;
            justify-content: flex-end;
            margin-top: 25px;
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .btn-primary {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .btn-secondary {
            background: #f5f5f5;
            color: #666;
        }

        .btn-secondary:hover {
            background: #e0e0e0;
        }

        /* Task Actions */
        .task-actions {
            display: none;
            gap: 5px;
            margin-left: auto;
        }

        .task-item:hover .task-actions {
            display: flex;
        }

        .task-action-btn {
            background: none;
            border: none;
            cursor: pointer;
            padding: 5px;
            border-radius: 4px;
            color: #999;
            font-size: 0.8rem;
            transition: all 0.3s ease;
        }

        .task-action-btn:hover {
            background: #f0f0f0;
            color: #333;
        }

        .task-action-btn.edit {
            color: #2196f3;
        }

        .task-action-btn.delete {
            color: #f44336;
        }

        /* Reminder Alert */
        .reminder-alert {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(255, 107, 107, 0.3);
            z-index: 2000;
            max-width: 300px;
            transform: translateX(100%);
            transition: transform 0.3s ease;
        }

        .reminder-alert.show {
            transform: translateX(0);
        }

        .reminder-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .reminder-title {
            font-weight: 600;
            font-size: 0.9rem;
        }

        .reminder-close {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            font-size: 1.2rem;
            padding: 0;
            width: 20px;
            height: 20px;
        }

        .reminder-text {
            font-size: 0.85rem;
            line-height: 1.3;
        }

        /* Priority indicator */
        .priority-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-left: 8px;
            flex-shrink: 0;
        }

        .priority-high {
            background: #ff4444;
            box-shadow: 0 0 10px rgba(255, 68, 68, 0.5);
        }

        .priority-medium {
            background: #ffaa00;
        }

        .priority-low {
            background: #00aa00;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Mind Map ToDo</h1>
            <p>Organize your tasks using the Eisenhower Matrix</p>
        </div>

        <div class="matrix" id="matrix">
            <!-- Categories will be dynamically generated here -->
        </div>

        <div class="stats">
            <h3>Progress Overview</h3>
            <div class="stats-grid">
                <div class="stat-item">
                    <div class="stat-number" id="totalTasks">0</div>
                    <div class="stat-label">Total Tasks</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="completedTasks">0</div>
                    <div class="stat-label">Completed</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="pendingTasks">0</div>
                    <div class="stat-label">Pending</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="progressPercent">0%</div>
                    <div class="stat-label">Progress</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Task Modal -->
    <div class="modal" id="taskModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title" id="modalTitle">Add New Task</div>
                <button class="close-btn" onclick="closeModal()">&times;</button>
            </div>
            <form id="taskForm">
                <div class="form-group">
                    <label class="form-label" for="taskText">Task Description</label>
                    <input type="text" id="taskText" class="form-input" placeholder="Enter task description..." required>
                </div>
                <div class="form-group">
                    <label class="form-label" for="taskCategory">Category</label>
                    <select id="taskCategory" class="form-select" required>
                        <option value="">Select category...</option>
                        <option value="urgent-important">Important & Urgent</option>
                        <option value="urgent-not-important">Not Important & Urgent</option>
                        <option value="not-urgent-important">Important & Not Urgent</option>
                        <option value="not-urgent-not-important">Not Important & Not Urgent</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label" for="taskPriority">Priority Level</label>
                    <select id="taskPriority" class="form-select">
                        <option value="low">Low Priority</option>
                        <option value="medium">Medium Priority</option>
                        <option value="high">High Priority</option>
                    </select>
                </div>
                <div class="checkbox-group">
                    <input type="checkbox" id="reminderEnabled" class="reminder-checkbox">
                    <label for="reminderEnabled" class="form-label">Enable reminders for this task</label>
                </div>
                <div class="form-group" id="reminderTimeGroup" style="display: none;">
                    <label class="form-label" for="reminderTime">Reminder Interval (minutes)</label>
                    <select id="reminderTime" class="form-select">
                        <option value="5">Every 5 minutes</option>
                        <option value="15">Every 15 minutes</option>
                        <option value="30">Every 30 minutes</option>
                        <option value="60">Every hour</option>
                    </select>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeModal()">Cancel</button>
                    <button type="submit" class="btn btn-primary" id="submitBtn">Add Task</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Reminder Alert -->
    <div class="reminder-alert" id="reminderAlert">
        <div class="reminder-header">
            <div class="reminder-title">⏰ Task Reminder</div>
            <button class="reminder-close" onclick="closeReminder()">&times;</button>
        </div>
        <div class="reminder-text" id="reminderText"></div>
    </div>

    <script>
        // Enhanced task data structure with preloaded tasks
        const defaultTaskData = {
            'urgent-important': {
                title: 'Important & Urgent',
                icon: '🔥',
                cssClass: 'urgent-important',
                tasks: [
                    'TEE Foundation',
                    'TEE XTREME Task Plan & Conduct Program',
                    'NPTEL Course: AI, Japanese, DSA, Python',
                    'AI Accelerate Course',
                    '30 Days Python',
                    'Microdegree Course',
                    'Ediglobe Course',
                    'Chatbot Project workshop completion',
                    'NS Engineer Sathi update channel & release content',
                    '15 Days Blockchain workshop (free)',
                    'Data Analytics Course Complete (IBM)'
                ]
            },
            'urgent-not-important': {
                title: 'Not Important & Urgent',
                icon: '⚡',
                cssClass: 'urgent-not-important',
                tasks: [
                    'UI Path Ambassador Check',
                    'Drawing portrait for Nov 1st',
                    'Install Story copy & J.V.',
                    'Discuss on Association updates',
                    'Build Application (Disease)'
                ]
            },
            'not-urgent-important': {
                title: 'Important & Not Urgent',
                icon: '💡',
                cssClass: 'not-urgent-important',
                tasks: [
                    'Setup LinkedIn, GitHub profile',
                    'Prepare DSA & Solve Leetcode',
                    'Practice GD, Email Writing',
                    'Learn DSA, SQL, OOPS, Array, List, Queues, Stack, Class, Loops',
                    'Company prepare',
                    'Get Certificates',
                    'AI & Deep Learning learn, notes',
                    'Search Internship',
                    'Major Project learn & build',
                    'Startup - Discuss, Approaches, Business card, etc.'
                ]
            },
            'not-urgent-not-important': {
                title: 'Not Important & Not Urgent',
                icon: '🎯',
                cssClass: 'not-urgent-not-important',
                tasks: [
                    'Company prepare',
                    '3830 rupees pending (TV)',
                    '80 - Saleem',
                    '1k - Prathima',
                    '200 - Brijesh',
                    '100 - Harshit',
                    '100 - Cham'
                ]
            }
        };

        // Enhanced state management
        let taskData = {};
        let taskStates = {};
        let taskMetadata = {}; // Stores priority, reminders, etc.
        let reminderIntervals = {};
        let currentEditingTask = null;

        // Initialize the application
        function init() {
            loadAllData();
            renderMatrix();
            updateStats();
            startReminderSystem();
            setupEventListeners();
        }

        // Load all data from localStorage
        function loadAllData() {
            // Load task data (custom + default)
            const savedTasks = localStorage.getItem('mindmap-todo-data');
            if (savedTasks) {
                try {
                    taskData = JSON.parse(savedTasks);
                } catch (e) {
                    console.warn('Failed to parse saved task data:', e);
                    taskData = JSON.parse(JSON.stringify(defaultTaskData));
                }
            } else {
                taskData = JSON.parse(JSON.stringify(defaultTaskData));
            }

            // Load task states
            const savedStates = localStorage.getItem('mindmap-todo-states');
            if (savedStates) {
                try {
                    taskStates = JSON.parse(savedStates);
                } catch (e) {
                    console.warn('Failed to parse saved task states:', e);
                    taskStates = {};
                }
            }

            // Load task metadata
            const savedMetadata = localStorage.getItem('mindmap-todo-metadata');
            if (savedMetadata) {
                try {
                    taskMetadata = JSON.parse(savedMetadata);
                } catch (e) {
                    console.warn('Failed to parse saved task metadata:', e);
                    taskMetadata = {};
                }
            }
        }

        // Save all data to localStorage
        function saveAllData() {
            try {
                localStorage.setItem('mindmap-todo-data', JSON.stringify(taskData));
                localStorage.setItem('mindmap-todo-states', JSON.stringify(taskStates));
                localStorage.setItem('mindmap-todo-metadata', JSON.stringify(taskMetadata));
            } catch (e) {
                console.warn('Failed to save data:', e);
            }
        }

        // Setup event listeners
        function setupEventListeners() {
            // Modal form submission
            document.getElementById('taskForm').addEventListener('submit', handleTaskSubmit);
            
            // Reminder checkbox toggle
            document.getElementById('reminderEnabled').addEventListener('change', function() {
                const reminderGroup = document.getElementById('reminderTimeGroup');
                reminderGroup.style.display = this.checked ? 'block' : 'none';
            });

            // Close modal on outside click
            document.getElementById('taskModal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeModal();
                }
            });
        }

        // Generate unique task ID
        function getTaskId(category, taskText) {
            return `${category}-${taskText.toLowerCase().replace(/[^a-z0-9]/g, '-')}`;
        }

        // Toggle task completion
        function toggleTask(category, taskText, element) {
            const taskId = getTaskId(category, taskText);
            taskStates[taskId] = !taskStates[taskId];
            
            // Add animation class for completion
            if (taskStates[taskId]) {
                element.classList.add('just-completed');
                setTimeout(() => element.classList.remove('just-completed'), 500);
            }
            
            // Update UI
            element.classList.toggle('completed', taskStates[taskId]);
            
            // Save state and update stats
            saveAllData();
            updateStats();
        }

        // Open modal for adding new task
        function openAddTaskModal(category = '') {
            currentEditingTask = null;
            document.getElementById('modalTitle').textContent = 'Add New Task';
            document.getElementById('submitBtn').textContent = 'Add Task';
            document.getElementById('taskForm').reset();
            
            if (category) {
                document.getElementById('taskCategory').value = category;
            }
            
            document.getElementById('taskModal').classList.add('show');
            document.getElementById('taskText').focus();
        }

        // Open modal for editing task
        function openEditTaskModal(category, taskText, taskId) {
            currentEditingTask = { category, taskText, taskId };
            document.getElementById('modalTitle').textContent = 'Edit Task';
            document.getElementById('submitBtn').textContent = 'Update Task';
            
            // Fill form with current task data
            document.getElementById('taskText').value = taskText;
            document.getElementById('taskCategory').value = category;
            
            const metadata = taskMetadata[taskId] || {};
            document.getElementById('taskPriority').value = metadata.priority || 'low';
            document.getElementById('reminderEnabled').checked = metadata.reminder || false;
            document.getElementById('reminderTime').value = metadata.reminderInterval || '15';
            
            // Show/hide reminder time group
            const reminderGroup = document.getElementById('reminderTimeGroup');
            reminderGroup.style.display = metadata.reminder ? 'block' : 'none';
            
            document.getElementById('taskModal').classList.add('show');
            document.getElementById('taskText').focus();
        }

        // Close modal
        function closeModal() {
            document.getElementById('taskModal').classList.remove('show');
            currentEditingTask = null;
        }

        // Handle task form submission
        function handleTaskSubmit(e) {
            e.preventDefault();
            
            const taskText = document.getElementById('taskText').value.trim();
            const category = document.getElementById('taskCategory').value;
            const priority = document.getElementById('taskPriority').value;
            const reminderEnabled = document.getElementById('reminderEnabled').checked;
            const reminderInterval = document.getElementById('reminderTime').value;
            
            if (!taskText || !category) {
                alert('Please fill in all required fields.');
                return;
            }
            
            if (currentEditingTask) {
                // Editing existing task
                updateTask(currentEditingTask, taskText, category, priority, reminderEnabled, reminderInterval);
            } else {
                // Adding new task
                addNewTask(taskText, category, priority, reminderEnabled, reminderInterval);
            }
            
            closeModal();
        }

        // Add new task
        function addNewTask(taskText, category, priority, reminderEnabled, reminderInterval) {
            // Add to task data
            if (!taskData[category]) {
                taskData[category] = { ...defaultTaskData[category], tasks: [] };
            }
            taskData[category].tasks.push(taskText);
            
            // Set metadata
            const taskId = getTaskId(category, taskText);
            taskMetadata[taskId] = {
                priority,
                reminder: reminderEnabled,
                reminderInterval: parseInt(reminderInterval),
                dateAdded: new Date().toISOString()
            };
            
            // Setup reminder if enabled
            if (reminderEnabled) {
                setupTaskReminder(taskId, taskText, parseInt(reminderInterval));
            }
            
            saveAllData();
            renderMatrix();
            updateStats();
        }

        // Update existing task
        function updateTask(editingTask, newTaskText, newCategory, priority, reminderEnabled, reminderInterval) {
            const { category: oldCategory, taskText: oldTaskText, taskId: oldTaskId } = editingTask;
            
            // Remove from old category if category changed
            if (oldCategory !== newCategory) {
                const oldIndex = taskData[oldCategory].tasks.indexOf(oldTaskText);
                if (oldIndex > -1) {
                    taskData[oldCategory].tasks.splice(oldIndex, 1);
                }
                
                // Add to new category
                if (!taskData[newCategory]) {
                    taskData[newCategory] = { ...defaultTaskData[newCategory], tasks: [] };
                }
                taskData[newCategory].tasks.push(newTaskText);
            } else if (oldTaskText !== newTaskText) {
                // Update task text in same category
                const index = taskData[oldCategory].tasks.indexOf(oldTaskText);
                if (index > -1) {
                    taskData[oldCategory].tasks[index] = newTaskText;
                }
            }
            
            // Update metadata
            const newTaskId = getTaskId(newCategory, newTaskText);
            
            // Transfer task state if IDs are different
            if (oldTaskId !== newTaskId) {
                taskStates[newTaskId] = taskStates[oldTaskId] || false;
                delete taskStates[oldTaskId];
                delete taskMetadata[oldTaskId];
                
                // Clear old reminder
                if (reminderIntervals[oldTaskId]) {
                    clearInterval(reminderIntervals[oldTaskId]);
                    delete reminderIntervals[oldTaskId];
                }
            }
            
            taskMetadata[newTaskId] = {
                ...taskMetadata[newTaskId],
                priority,
                reminder: reminderEnabled,
                reminderInterval: parseInt(reminderInterval),
                dateModified: new Date().toISOString()
            };
            
            // Setup reminder if enabled
            if (reminderEnabled) {
                setupTaskReminder(newTaskId, newTaskText, parseInt(reminderInterval));
            } else if (reminderIntervals[newTaskId]) {
                clearInterval(reminderIntervals[newTaskId]);
                delete reminderIntervals[newTaskId];
            }
            
            saveAllData();
            renderMatrix();
            updateStats();
        }

        // Delete task
        function deleteTask(category, taskText, taskId) {
            if (!confirm('Are you sure you want to delete this task?')) {
                return;
            }
            
            // Remove from task data
            const index = taskData[category].tasks.indexOf(taskText);
            if (index > -1) {
                taskData[category].tasks.splice(index, 1);
            }
            
            // Clean up state and metadata
            delete taskStates[taskId];
            delete taskMetadata[taskId];
            
            // Clear reminder if exists
            if (reminderIntervals[taskId]) {
                clearInterval(reminderIntervals[taskId]);
                delete reminderIntervals[taskId];
            }
            
            saveAllData();
            renderMatrix();
            updateStats();
        }

        // Reminder System
        function setupTaskReminder(taskId, taskText, intervalMinutes) {
            // Clear existing reminder if any
            if (reminderIntervals[taskId]) {
                clearInterval(reminderIntervals[taskId]);
            }
            
            // Set new reminder
            const intervalMs = intervalMinutes * 60 * 1000;
            reminderIntervals[taskId] = setInterval(() => {
                // Only show reminder if task is not completed
                if (!taskStates[taskId]) {
                    showReminder(taskText);
                }
            }, intervalMs);
        }

        function showReminder(taskText) {
            const reminderAlert = document.getElementById('reminderAlert');
            const reminderTextEl = document.getElementById('reminderText');
            
            reminderTextEl.textContent = `Don't forget: ${taskText}`;
            reminderAlert.classList.add('show');
            
            // Auto-hide after 10 seconds
            setTimeout(() => {
                reminderAlert.classList.remove('show');
            }, 10000);
        }

        function closeReminder() {
            document.getElementById('reminderAlert').classList.remove('show');
        }

        function startReminderSystem() {
            // Setup reminders for all tasks that have them enabled
            Object.entries(taskMetadata).forEach(([taskId, metadata]) => {
                if (metadata.reminder && metadata.reminderInterval) {
                    // Find task text from taskId
                    for (const [category, data] of Object.entries(taskData)) {
                        const task = data.tasks.find(task => getTaskId(category, task) === taskId);
                        if (task) {
                            setupTaskReminder(taskId, task, metadata.reminderInterval);
                            break;
                        }
                    }
                }
            });
        }

        // Get priority class for task
        function getPriorityClass(taskId) {
            const metadata = taskMetadata[taskId];
            if (metadata && metadata.priority) {
                return `priority-${metadata.priority}`;
            }
            return 'priority-low';
        }

        // Render the matrix
        function renderMatrix() {
            const matrix = document.getElementById('matrix');
            matrix.innerHTML = '';

            Object.entries(taskData).forEach(([category, data]) => {
                const card = document.createElement('div');
                card.className = `category-card ${data.cssClass}`;

                const completedCount = data.tasks.filter(task => 
                    taskStates[getTaskId(category, task)]
                ).length;

                card.innerHTML = `
                    <div class="category-header">
                        <div class="category-icon">${data.icon}</div>
                        <div class="category-title">${data.title}</div>
                        <div class="task-count">${completedCount}/${data.tasks.length}</div>
                    </div>
                    <ul class="task-list">
                        ${data.tasks.map(task => {
                            const taskId = getTaskId(category, task);
                            const isCompleted = taskStates[taskId] || false;
                            const priorityClass = getPriorityClass(taskId);
                            const hasReminder = taskMetadata[taskId]?.reminder ? '⏰' : '';
                            return `
                                <li class="task-item ${isCompleted ? 'completed' : ''}" >
                                    <div class="task-checkbox" onclick="toggleTask('${category}', '${task.replace(/'/g, "\\'")}', this.parentElement)"></div>
                                    <div class="task-text" onclick="toggleTask('${category}', '${task.replace(/'/g, "\\'")}', this.parentElement)">${task} ${hasReminder}</div>
                                    <div class="priority-indicator ${priorityClass}"></div>
                                    <div class="task-actions">
                                        <button class="task-action-btn edit" onclick="openEditTaskModal('${category}', '${task.replace(/'/g, "\\'")}', '${taskId}')" title="Edit task">✏️</button>
                                        <button class="task-action-btn delete" onclick="deleteTask('${category}', '${task.replace(/'/g, "\\'")}', '${taskId}')" title="Delete task">🗑️</button>
                                    </div>
                                </li>
                            `;
                        }).join('')}
                    </ul>
                    <button class="add-task-btn" onclick="openAddTaskModal('${category}')">
                        ➕ Add Task
                    </button>
                `;

                matrix.appendChild(card);
            });
        }

        // Update statistics
        function updateStats() {
            let totalTasks = 0;
            let completedTasks = 0;

            Object.entries(taskData).forEach(([category, data]) => {
                totalTasks += data.tasks.length;
                completedTasks += data.tasks.filter(task => 
                    taskStates[getTaskId(category, task)]
                ).length;
            });

            const pendingTasks = totalTasks - completedTasks;
            const progressPercent = totalTasks > 0 ? Math.round((completedTasks / totalTasks) * 100) : 0;

            // Update DOM elements
            document.getElementById('totalTasks').textContent = totalTasks;
            document.getElementById('completedTasks').textContent = completedTasks;
            document.getElementById('pendingTasks').textContent = pendingTasks;
            document.getElementById('progressPercent').textContent = `${progressPercent}%`;
        }

        // Initialize the app when DOM is loaded
        document.addEventListener('DOMContentLoaded', init);

        // Handle page visibility change to save state
        document.addEventListener('visibilitychange', () => {
            if (document.hidden) {
                saveAllData();
            }
        });

        // Save state before page unload
        window.addEventListener('beforeunload', saveAllData);

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            // ESC to close modal
            if (e.key === 'Escape') {
                closeModal();
                closeReminder();
            }
            // Ctrl/Cmd + N to add new task
            if ((e.ctrlKey || e.metaKey) && e.key === 'n') {
                e.preventDefault();
                openAddTaskModal();
            }
        });
    </script>
</body>
</html>
